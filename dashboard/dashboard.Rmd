---
title: "Shumai User Interest Profiling"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows #def columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include = FALSE}
source("../setup.R")
#source("../test.R")
source("../support.R")
values <- reactiveValues()
```


Setup
=====================================

-----------------------------------------------------------------------

### Setup Window
Please retrieve the user database first.
```{r echo = FALSE}
hr()
textInput("db.get.link", label = h3("DB Link"), value = "pumi-4-1.tddc88-2018.ida.liu.se:8085/api/user")
actionButton("buttonGetDB", "Fetch User Database")

#fetchDB <- eventReactive(input$buttonGetDB, {
observeEvent(input$buttonGetDB,  {
  print("buttonGetDB pressed")
  channel.df <- ImportJSON(input$db.get.link)
  values$raw.data <- channel.df
  print(colnames(values$raw.data))
})

hr()
```

Trends
=====================================
Settings {.sidebar}
-----------------------------------------------------------------------
#### Time period
Select the time period to analyze.
```{r echo = FALSE}
dateRangeInput('dateRange',
      label = 'Date range input: yyyy-mm-dd',
      start = Sys.Date() - 7, end = Sys.Date(),
      max = Sys.Date()
    )
```

#### Categories
```{r}
category.list.names <- c("Animals", "Cars", "Celeb", "Comedy & Entertainment", "Creative", "Education", "Gaming", "Kids", "Lifestyle & How-to", "Movies", "Music", "News", "Sports", "Tech", "Travel", "TV", "Webcam")
category.list.id <- tolower(category.list.names)

#lapply(seq(category.list.id), function(i) {
  #sliderInput(inputId = paste0("range", category.list.id[i]),
  #            label = category.list.names[i],
  #            min = 0, max = 1, value = c(0, 1))
#})

sliderInput(inputId = "range.animals", label = "Animals",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.cars", label = "Cars",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.celeb", label = "Celeb",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.comedy.entertainment", label = "Comedy & Entertainment",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.creative", label = "Creative",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.education", label = "Education",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.gaming", label = "Gaming",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.kids", label = "Kids",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.lifestyle.how-to", label = "Lifestyle & How-to",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.movies", label = "Movies",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.music", label = "Music",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.news", label = "News",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.sports", label = "Sports",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.tech", label = "Tech",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.travel", label = "Travel",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.tv", label = "TV",
            min = 0, max = 1, value = c(0, 1))
sliderInput(inputId = "range.webcam", label = "Webcam",
            min = 0, max = 1, value = c(0, 1))
hr()
```

#### Export
```{r}
actionButton("buttonExportFilteredUsers", "Export current filtering")

observeEvent(input$ExportFilteredUsers, {
  print("buttonExportFilteredUsers pressed")
  # TODO: Call function in support.R
})
hr()
```


Column {data-width=650}
-----------------------------------------------------------------------

### Chart Heatmap
```{r}
#https://cran.r-project.org/web/packages/d3heatmap/d3heatmap.pdf
print("Heatmap")
#d3heatmap(dt1, scale = "none", dendrogram = "none", colors = "Blues", show_grid = FALSE, Rowv = FALSE)
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart Histogram
```{r}
print("Histogram")

```

### Chart Ridge
```{r}
print("Ggridge")
#ggplot(df.stack, aes(x = values, y = ind)) +
#  geom_density_ridges(aes(group = ind, color = ind), alpha = 0.3)
```


Statistics
=====================================

Row
-----------------------------------------------------------------------

### Unique users {.value-box}
```{r}
# usrCount is a reactive expression that keeps an approximate
# count of all of the unique users that have been seen since the
# app started.
usrCount <- 13
renderValueBox({
  valueBox(value = usrCount, icon = "glyphicon-user")
})
```

### Total video views {.value-box}
```{r}
renderValueBox({
  views <- 123456
  valueBox(value = views, icon = "glyphicon-play")
})
```

### Average total daily views {.value-box}
```{r}
renderValueBox({
  valueBox(value = 123, icon = "glyphicon-eye-open")
})
```

Row
-----------------------------------------------------------------------
### Most popular category {.value-box}
```{r}
renderValueBox({
  valueBox(value = "Memes", color = "Green", icon = "glyphicon-thumbs-up")
})
```

### Least popular category {.value-box}
```{r}
renderValueBox({
  valueBox(value = "News", color = "Maroon", icon = "glyphicon-thumbs-down")
})
```



Column {data-width=650}
-----------------------------------------------------------------------

### User Interest Statistics
```{r}
# UI function
#worldPhonesUI <- function(id) {
#  ns <- NS(id)
#  fillCol(height = 600, flex = c(NA, 1), 
#    inputPanel(
#      selectInput(ns("region"), "Region:", choices = colnames(WorldPhones))
#    ),
#    plotOutput(ns("phonePlot"), height = "100%")
#  )
#}

# Server function
#worldPhones <- function(input, output, session) {
#  output$phonePlot <- renderPlot({
#    barplot(WorldPhones[,input$region]*1000, 
#            ylab = "Number of Telephones", xlab = "Year")
#  })
#}
#worldPhonesUI("phones")
#callModule(worldPhones, "phones")
```